<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.4.0/styles/github-dark.min.css"/><meta name="next-head-count" content="3"/><link rel="preload" href="/_next/static/css/35cab027331baf7e.css" as="style"/><link rel="stylesheet" href="/_next/static/css/35cab027331baf7e.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-ee7e63bc15b31913.js" defer=""></script><script src="/_next/static/chunks/framework-2c79e2a64abdb08b.js" defer=""></script><script src="/_next/static/chunks/main-83cebdb887f48834.js" defer=""></script><script src="/_next/static/chunks/pages/_app-3ca76a984b940bc2.js" defer=""></script><script src="/_next/static/chunks/465-4fe278bcc6195523.js" defer=""></script><script src="/_next/static/chunks/671-33206bff58acfdee.js" defer=""></script><script src="/_next/static/chunks/803-0cdd1b04f7cffd56.js" defer=""></script><script src="/_next/static/chunks/pages/blog/%5Bid%5D-46caa1db85c0b62b.js" defer=""></script><script src="/_next/static/DPwb1nK7hmgB_yIPdLqpw/_buildManifest.js" defer=""></script><script src="/_next/static/DPwb1nK7hmgB_yIPdLqpw/_ssgManifest.js" defer=""></script><style id="__jsx-1af872c17140788a">.img-text.jsx-1af872c17140788a{display:block;text-align:center;font-family:"Source Sans Pro",sans-serif;font-size:-webkit-calc(.8rem + .1vw);font-size:-moz-calc(.8rem + .1vw);font-size:calc(.8rem + .1vw);color:#1d2b35;word-wrap:"break-word";overflow-wrap:"break-word"}a.jsx-1af872c17140788a{margin:0;text-decoration:none;color:#1d2b35;border-bottom:1px solid}</style><style id="__jsx-4b699aa219fdc237">.blog-content.jsx-4b699aa219fdc237{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-flex:100%;-webkit-flex:100%;-moz-box-flex:100%;-ms-flex:100%;flex:100%;-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-flex-direction:column;-moz-box-orient:vertical;-moz-box-direction:normal;-ms-flex-direction:column;flex-direction:column;margin:1vw 25vw 1vw 25vw;width:50vw;max-width:50vw}</style></head><body><div id="__next"><header class="Header_header__iG0T4"><div class="flex items-center h-16 px-4"><h2><a class="font-bold text-2xl flex-1" href="/">PressBlog</a></h2><ul><li><a href="/about">About</a></li><li><a href="/blog/super-fast-python-good-practices#">GitHub Code</a></li></ul></div></header><main><div class="p-4 flex justify-center"><div class="w-11/12 md:w-7/12 prose prose-table"><article class="jsx-4b699aa219fdc237"><p style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);color:#071013f2;margin:0vh 0 1vh 0;overflow-wrap:break-word"><picture class="jsx-1af872c17140788a"><img src="/images/super-fast-python-good-practices/super-fast-python-good-practices.jpg" alt="Super fast Python: Good Practices" style="width:100%;max-width:100%;height:auto;margin-left:0%" class="jsx-1af872c17140788a"/><span class="jsx-1af872c17140788a img-text"></span></picture></p>
<h1 style="font-family:&#x27;Ubuntu&#x27;, sans-serif;font-size:calc(1rem + 1.5vw);color:#1d2b35;margin:1vh 0 1vh 0;overflow-wrap:break-word" id="">Super fast Python (Part-2): Good practices</h1>
<p style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);color:#071013f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">In the earlier post on <a style="color:#071013;text-decoration:none;cursor:pointer;border-bottom:1px dashed #fb232e;font-size:calc(1rem + 0.1vw);font-weight:bold;overflow-wrap:break-word" target="_blank" rel="noreferrer" href="https://santhalakshminarayana.github.io/blog/super-fast-python-why-python-slow">why Python is slow?</a>, we discussed slowness is in Python due to its internal design of some essential components like GIL, dynamic typing, and interpretation.</p>
<p style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);color:#071013f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">In this blog, we discuss some good practices to speed up Python incredibly faster.</p>
<p style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);color:#071013f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">This is the second post in the series on Python performance and Optimization. The series points out the utilization of inbuilt libraries, low-level code conversions, and other Python implementations to speed-up Python. The other posts included in this series are</p>
<ul style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);color:#071013e6;margin:1vh 0 1vh calc(2vw);overflow-wrap:break-word">
<li>(Part-1): <a style="color:#071013;text-decoration:none;cursor:pointer;border-bottom:1px dashed #fb232e;font-size:calc(1rem + 0.1vw);font-weight:bold;overflow-wrap:break-word" target="_blank" rel="noreferrer" href="https://santhalakshminarayana.github.io/blog/super-fast-python-why-python-slow">Why Python is slow?</a></li>
<li>(Part-2): Good practices to write fast Python code (this post)</li>
<li>(Part-3): <a style="color:#071013;text-decoration:none;cursor:pointer;border-bottom:1px dashed #fb232e;font-size:calc(1rem + 0.1vw);font-weight:bold;overflow-wrap:break-word" target="_blank" rel="noreferrer" href="https://santhalakshminarayana.github.io/blog/super-fast-python-multi-processing">Multi-processing in Python</a></li>
<li>(Part-4): <a style="color:#071013;text-decoration:none;cursor:pointer;border-bottom:1px dashed #fb232e;font-size:calc(1rem + 0.1vw);font-weight:bold;overflow-wrap:break-word" target="_blank" rel="noreferrer" href="https://santhalakshminarayana.github.io/blog/super-fast-python-cython">Use Cython to get speed as fast as C</a></li>
<li>(Part-5): <a style="color:#071013;text-decoration:none;cursor:pointer;border-bottom:1px dashed #fb232e;font-size:calc(1rem + 0.1vw);font-weight:bold;overflow-wrap:break-word" target="_blank" rel="noreferrer" href="https://santhalakshminarayana.github.io/blog/super-fast-python-numba">Use Numba to speed up Python Functions and Numeric calculations</a></li>
</ul>
<p style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);color:#071013f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">The following section describes the various good practices one can use to make Python super speed (up to 30% or more) without any external support like PyPy, Cython, Numpy, etc.</p>
<h2 style="font-family:&#x27;Maven Pro&#x27;, sans-serif;font-size:calc(1rem + 1vw);color:#1d2b35;margin:1vh 0 1vh 0;overflow-wrap:break-word" id="">Python good practices for super fast code</h2>
<h3 style="font-family:&#x27;Maven Pro&#x27;, sans-serif;font-size:calc(1rem + 0.5vw);color:#1d2b35;margin:1vh 0 1vh 0;overflow-wrap:break-word" id="">Use built-in data structures and libraries</h3>
<p style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);color:#071013f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">As Python data types are implemented directly in <strong style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);font-style:normal;font-weight:bold;color:#1d2b35f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">C</strong>, using the built-in types like list, map, and trees, compared to custom types we define, really helps the program to run faster.</p>
<p style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);color:#071013f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">Also, use built-in libraries for common algorithms like counting the duplicates, summing all list elements, finding the maximum element, etc, because these are all already written in <strong style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);font-style:normal;font-weight:bold;color:#1d2b35f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">C</strong> and compiled which makes these functions run faster than custom functions we write.</p>
<pre><code class="language-python">from random import randint

rand_nums = [randint(1, 100) for _ in range(100000)]
</code></pre>
<p style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);color:#071013f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">Create 100000 random numbers between 1 and 100.</p>
<pre><code class="language-python">%%timeit
cc = 0
for i in range(len(rand_nums)):
    cc += rand_nums[i]
</code></pre>
<pre><code class="language-python:output">6.02 ms ± 94 µs per loop (mean ± std. dev. of 7 runs, 100 loops each)
</code></pre>
<p style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);color:#071013f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">Manually summing up the all numbers over running a loop takes approximately 6ms.</p>
<pre><code class="language-python">%%timeit
cc = sum(rand_nums)
</code></pre>
<pre><code class="language-python:output">332 µs ± 15 µs per loop (mean ± std. dev. of 7 runs, 1000 loops each)
</code></pre>
<p style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);color:#071013f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">Using built-in <em style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);font-style:normal;background-color:#07101326;color:#071013f2;margin:0vh 0 1vh 0;padding:0 2px 0 2px;border-radius:2px">sum()</em> takes only 0.3ms approximately.</p>
<h3 style="font-family:&#x27;Maven Pro&#x27;, sans-serif;font-size:calc(1rem + 0.5vw);color:#1d2b35;margin:1vh 0 1vh 0;overflow-wrap:break-word" id="">Local Variables vs Global Variables</h3>
<p style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);color:#071013f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">When we call a function (a routine), the system pauses the code execution at the call site in the current routine (say <strong style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);font-style:normal;font-weight:bold;color:#1d2b35f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">main()</strong>) where the call has been made and places the called function at the top of the call stack. Imagine if we have defined numerous global variables and made multiple function calls. The system has to make sure that all these global variables should be available for any routine placed in the call stack at all times. The system has to provide a lookup mechanism for both local and global variables for each routine. And with global variables, this lookup mechanism may take some time than local variables.</p>
<h3 style="font-family:&#x27;Maven Pro&#x27;, sans-serif;font-size:calc(1rem + 0.5vw);color:#1d2b35;margin:1vh 0 1vh 0;overflow-wrap:break-word" id="">Import the sub-modules and functions directly</h3>
<p style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);color:#071013f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">When importing any module to use its sub-modules, classes, or functions, import them directly instead of importing just the module. When accessing objects using <em style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);font-style:normal;background-color:#07101326;color:#071013f2;margin:0vh 0 1vh 0;padding:0 2px 0 2px;border-radius:2px">.</em>, it triggers dictionary lookup using <em style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);font-style:normal;background-color:#07101326;color:#071013f2;margin:0vh 0 1vh 0;padding:0 2px 0 2px;border-radius:2px">__getattribute__</em>. If we call the object multiple times using <em style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);font-style:normal;background-color:#07101326;color:#071013f2;margin:0vh 0 1vh 0;padding:0 2px 0 2px;border-radius:2px">.</em>, that may increase the program time.</p>
<pre><code class="language-python"># instead of this
import abc
def_obj = abc.Def()

# do this
from abc import Def
def_obj = Def()
</code></pre>
<h3 style="font-family:&#x27;Maven Pro&#x27;, sans-serif;font-size:calc(1rem + 0.5vw);color:#1d2b35;margin:1vh 0 1vh 0;overflow-wrap:break-word" id="">Limit the usage of &#x27;.&#x27;</h3>
<p style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);color:#071013f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">Speaking of the lookup time with the module&#x27;s object references, the same can be applied to the referencing of properties and functions of an object(both custom and in-built).</p>
<pre><code class="language-python">%%timeit
ll = []
for i in range(len(rand_nums)):
    ll.append(rand_nums[i])
</code></pre>
<pre><code class="language-python:output">6.67 ms ± 84.7 µs per loop (mean ± std. dev. of 7 runs, 100 loops each)
</code></pre>
<p style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);color:#071013f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">Adding the list elements by appending with <em style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);font-style:normal;background-color:#07101326;color:#071013f2;margin:0vh 0 1vh 0;padding:0 2px 0 2px;border-radius:2px">list.append()</em> takes more time than following code because the function is assigned to a variable (functions are first-class citizens in Python) and used inside the loop. This simple practice avoids referencing the functions with <strong style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);font-style:normal;font-weight:bold;color:#1d2b35f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">&#x27;.&#x27;</strong> too often and finally limits the need for dictionary lookup.</p>
<pre><code class="language-python">%%timeit
ll = []
ll_append = ll.append
for i in range(len(rand_nums)):
    ll_append(rand_nums[i])
</code></pre>
<pre><code class="language-python:output">5.45 ms ± 116 µs per loop (mean ± std. dev. of 7 runs, 100 loops each)
</code></pre>
<h3 style="font-family:&#x27;Maven Pro&#x27;, sans-serif;font-size:calc(1rem + 0.5vw);color:#1d2b35;margin:1vh 0 1vh 0;overflow-wrap:break-word" id="">Avoid writing functions unnecessary</h3>
<p style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);color:#071013f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">It&#x27;s good to have code separability by using functions for each independent task. But, as functions in Python are relatively more expensive than C/C++ due to boxing and unboxing dynamic variables and other factors, limit writing functions for unnecessary cases like one-liners.</p>
<h3 style="font-family:&#x27;Maven Pro&#x27;, sans-serif;font-size:calc(1rem + 0.5vw);color:#1d2b35;margin:1vh 0 1vh 0;overflow-wrap:break-word" id="">Don&#x27;t wrap lambdas around functions</h3>
<p style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);color:#071013f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">Overuse or misuse of lambdas is not a good practice. It&#x27;s common to wrap functions inside lambdas which do the same thing without wrapping.</p>
<p style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);color:#071013f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">Consider the following two functions for sorting a list based on absolute values.</p>
<pre><code class="language-python">def fun_sort_with_lambda(l):
    return sorted(l, key=lambda x: abs(x))

def fun_sort_without_lambda(l):
    return sorted(l, key=abs)
</code></pre>
<p style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);color:#071013f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">If we look at the CPython bytecode for the above functions with lambda expression passed as a key and with <em style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);font-style:normal;background-color:#07101326;color:#071013f2;margin:0vh 0 1vh 0;padding:0 2px 0 2px;border-radius:2px">abs</em> function object as a key,</p>
<pre><code class="language-python">&gt;&gt;&gt; from dis import dis
&gt;&gt;&gt; dis(fun_sort_with_lambda)
  2           0 LOAD_GLOBAL              0 (sorted)
              2 LOAD_FAST                0 (l)
              4 LOAD_CONST               1 (&lt;code object &lt;lambda&gt; at 0x7fc51b3a19d0, file &quot;&lt;ipython-input-62-c4147c242c71&gt;&quot;, line 2&gt;)
              6 LOAD_CONST               2 (&#x27;fun_sort_with_lambda.&lt;locals&gt;.&lt;lambda&gt;&#x27;)
              8 MAKE_FUNCTION            0
             10 LOAD_CONST               3 ((&#x27;key&#x27;,))
             12 CALL_FUNCTION_KW         2
             14 RETURN_VALUE

Disassembly of &lt;code object &lt;lambda&gt; at 0x7fc51b3a19d0, file &quot;&lt;ipython-input-62-c4147c242c71&gt;&quot;, line 2&gt;:
  2           0 LOAD_GLOBAL              0 (abs)
              2 LOAD_FAST                0 (x)
              4 CALL_FUNCTION            1
              6 RETURN_VALUE

&gt;&gt;&gt; dis(fun_sort_without_lambda)
  2           0 LOAD_GLOBAL              0 (sorted)
              2 LOAD_FAST                0 (l)
              4 LOAD_GLOBAL              1 (abs)
              6 LOAD_CONST               1 ((&#x27;key&#x27;,))
              8 CALL_FUNCTION_KW         2
             10 RETURN_VALUE
</code></pre>
<p style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);color:#071013f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">for the function <em style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);font-style:normal;background-color:#07101326;color:#071013f2;margin:0vh 0 1vh 0;padding:0 2px 0 2px;border-radius:2px">fun_sort_with_lambda</em>, there is an additional function has been generated for lambda. We can avoid this function generation without using lambda as we can see in function <em style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);font-style:normal;background-color:#07101326;color:#071013f2;margin:0vh 0 1vh 0;padding:0 2px 0 2px;border-radius:2px">fun_sort_without_lambda</em>.</p>
<h3 style="font-family:&#x27;Maven Pro&#x27;, sans-serif;font-size:calc(1rem + 0.5vw);color:#1d2b35;margin:1vh 0 1vh 0;overflow-wrap:break-word" id="">List comprehension is fast</h3>
<p style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);color:#071013f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">When operating over lists like data structures, list comprehension is faster than traditional methods like looping, functional programming, etc.</p>
<pre><code class="language-python">%%timeit
rand_nums = []
for _ in range(1000):
    rand_nums.append(randint(1, 100))
</code></pre>
<pre><code class="language-output">603 µs ± 15.3 µs per loop (mean ± std. dev. of 7 runs, 1000 loops each)
</code></pre>
<p style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);color:#071013f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">The list comprehension version of the above code snippet runs faster.</p>
<pre><code class="language-python:output">%%timeit
rand_nums = [randint(1, 100) for _ in range(1000)]
</code></pre>
<pre><code class="language-python:output">565 µs ± 11 µs per loop (mean ± std. dev. of 7 runs, 1000 loops each)
</code></pre>
<hr style="margin:2vh 25% 2vh 25%;border:1px solid #07101380"/>
<p style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);color:#071013f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">The optimization practices are not limited to the above approaches. We can check how much time it is taking for each line by using libraries like <a style="color:#071013;text-decoration:none;cursor:pointer;border-bottom:1px dashed #fb232e;font-size:calc(1rem + 0.1vw);font-weight:bold;overflow-wrap:break-word" target="_blank" rel="noreferrer" href="https://docs.python.org/3/library/profile.html">CProfile</a> and making changes to run faster. In the next blog, we discuss how to improve Python computing efficiency using multiprocessing.</p>
<hr style="margin:2vh 25% 2vh 25%;border:1px solid #07101380"/>
<h3 style="font-family:&#x27;Maven Pro&#x27;, sans-serif;font-size:calc(1rem + 0.5vw);color:#1d2b35;margin:1vh 0 1vh 0;overflow-wrap:break-word" id="">References</h3>
<ul style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);color:#071013e6;margin:1vh 0 1vh calc(2vw);overflow-wrap:break-word">
<li><a style="color:#071013;text-decoration:none;cursor:pointer;border-bottom:1px dashed #fb232e;font-size:calc(1rem + 0.1vw);font-weight:bold;overflow-wrap:break-word" target="_blank" rel="noreferrer" href="https://wiki.python.org/moin/PythonSpeed">Python Speed</a></li>
<li><a style="color:#071013;text-decoration:none;cursor:pointer;border-bottom:1px dashed #fb232e;font-size:calc(1rem + 0.1vw);font-weight:bold;overflow-wrap:break-word" target="_blank" rel="noreferrer" href="https://aglowiditsolutions.com/blog/python-optimization/">Python Optimization</a></li>
<li><a style="color:#071013;text-decoration:none;cursor:pointer;border-bottom:1px dashed #fb232e;font-size:calc(1rem + 0.1vw);font-weight:bold;overflow-wrap:break-word" target="_blank" rel="noreferrer" href="https://martinheinz.dev/blog/13">Making Python Programs Blazingly Fast</a></li>
</ul></article></div></div></main></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"postMetadata":{"title":"Super fast Python (Part-2): Good Practices","description":"Write Python programs by following good practices to run code incredibly faster.","imgName":"super-fast-python-good-practices/super-fast-python-good-practices.jpg","date":"Nov 9, 2022","tags":["python-performance"],"keywords":["python-performance","python-optimize","python","fast-python","speed","python"],"id":"super-fast-python-good-practices"},"postContent":{"compiledSource":"/*@jsxRuntime automatic @jsxImportSource react*/\nconst {Fragment: _Fragment, jsx: _jsx, jsxs: _jsxs} = arguments[0];\nconst {useMDXComponents: _provideComponents} = arguments[0];\nfunction _createMdxContent(props) {\n  const _components = Object.assign({\n    p: \"p\",\n    img: \"img\",\n    h1: \"h1\",\n    a: \"a\",\n    ul: \"ul\",\n    li: \"li\",\n    h2: \"h2\",\n    h3: \"h3\",\n    strong: \"strong\",\n    pre: \"pre\",\n    code: \"code\",\n    em: \"em\",\n    hr: \"hr\"\n  }, _provideComponents(), props.components);\n  return _jsxs(_Fragment, {\n    children: [_jsx(_components.p, {\n      children: _jsx(_components.img, {\n        src: \"super-fast-python-good-practices/super-fast-python-good-practices.jpg\",\n        alt: \"Super fast Python: Good Practices\"\n      })\n    }), \"\\n\", _jsx(_components.h1, {\n      children: \"Super fast Python (Part-2): Good practices\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"In the earlier post on \", _jsx(_components.a, {\n        href: \"https://santhalakshminarayana.github.io/blog/super-fast-python-why-python-slow\",\n        children: \"why Python is slow?\"\n      }), \", we discussed slowness is in Python due to its internal design of some essential components like GIL, dynamic typing, and interpretation.\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"In this blog, we discuss some good practices to speed up Python incredibly faster.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"This is the second post in the series on Python performance and Optimization. The series points out the utilization of inbuilt libraries, low-level code conversions, and other Python implementations to speed-up Python. The other posts included in this series are\"\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsxs(_components.li, {\n        children: [\"(Part-1): \", _jsx(_components.a, {\n          href: \"https://santhalakshminarayana.github.io/blog/super-fast-python-why-python-slow\",\n          children: \"Why Python is slow?\"\n        })]\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"(Part-2): Good practices to write fast Python code (this post)\"\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [\"(Part-3): \", _jsx(_components.a, {\n          href: \"https://santhalakshminarayana.github.io/blog/super-fast-python-multi-processing\",\n          children: \"Multi-processing in Python\"\n        })]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [\"(Part-4): \", _jsx(_components.a, {\n          href: \"https://santhalakshminarayana.github.io/blog/super-fast-python-cython\",\n          children: \"Use Cython to get speed as fast as C\"\n        })]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [\"(Part-5): \", _jsx(_components.a, {\n          href: \"https://santhalakshminarayana.github.io/blog/super-fast-python-numba\",\n          children: \"Use Numba to speed up Python Functions and Numeric calculations\"\n        })]\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"The following section describes the various good practices one can use to make Python super speed (up to 30% or more) without any external support like PyPy, Cython, Numpy, etc.\"\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Python good practices for super fast code\"\n    }), \"\\n\", _jsx(_components.h3, {\n      children: \"Use built-in data structures and libraries\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"As Python data types are implemented directly in \", _jsx(_components.strong, {\n        children: \"C\"\n      }), \", using the built-in types like list, map, and trees, compared to custom types we define, really helps the program to run faster.\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Also, use built-in libraries for common algorithms like counting the duplicates, summing all list elements, finding the maximum element, etc, because these are all already written in \", _jsx(_components.strong, {\n        children: \"C\"\n      }), \" and compiled which makes these functions run faster than custom functions we write.\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-python\",\n        children: \"from random import randint\\n\\nrand_nums = [randint(1, 100) for _ in range(100000)]\\n\"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Create 100000 random numbers between 1 and 100.\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-python\",\n        children: \"%%timeit\\ncc = 0\\nfor i in range(len(rand_nums)):\\n    cc += rand_nums[i]\\n\"\n      })\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-python:output\",\n        children: \"6.02 ms ± 94 µs per loop (mean ± std. dev. of 7 runs, 100 loops each)\\n\"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Manually summing up the all numbers over running a loop takes approximately 6ms.\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-python\",\n        children: \"%%timeit\\ncc = sum(rand_nums)\\n\"\n      })\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-python:output\",\n        children: \"332 µs ± 15 µs per loop (mean ± std. dev. of 7 runs, 1000 loops each)\\n\"\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Using built-in \", _jsx(_components.em, {\n        children: \"sum()\"\n      }), \" takes only 0.3ms approximately.\"]\n    }), \"\\n\", _jsx(_components.h3, {\n      children: \"Local Variables vs Global Variables\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"When we call a function (a routine), the system pauses the code execution at the call site in the current routine (say \", _jsx(_components.strong, {\n        children: \"main()\"\n      }), \") where the call has been made and places the called function at the top of the call stack. Imagine if we have defined numerous global variables and made multiple function calls. The system has to make sure that all these global variables should be available for any routine placed in the call stack at all times. The system has to provide a lookup mechanism for both local and global variables for each routine. And with global variables, this lookup mechanism may take some time than local variables.\"]\n    }), \"\\n\", _jsx(_components.h3, {\n      children: \"Import the sub-modules and functions directly\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"When importing any module to use its sub-modules, classes, or functions, import them directly instead of importing just the module. When accessing objects using \", _jsx(_components.em, {\n        children: \".\"\n      }), \", it triggers dictionary lookup using \", _jsx(_components.em, {\n        children: \"__getattribute__\"\n      }), \". If we call the object multiple times using \", _jsx(_components.em, {\n        children: \".\"\n      }), \", that may increase the program time.\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-python\",\n        children: \"# instead of this\\nimport abc\\ndef_obj = abc.Def()\\n\\n# do this\\nfrom abc import Def\\ndef_obj = Def()\\n\"\n      })\n    }), \"\\n\", _jsx(_components.h3, {\n      children: \"Limit the usage of '.'\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Speaking of the lookup time with the module's object references, the same can be applied to the referencing of properties and functions of an object(both custom and in-built).\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-python\",\n        children: \"%%timeit\\nll = []\\nfor i in range(len(rand_nums)):\\n    ll.append(rand_nums[i])\\n\"\n      })\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-python:output\",\n        children: \"6.67 ms ± 84.7 µs per loop (mean ± std. dev. of 7 runs, 100 loops each)\\n\"\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Adding the list elements by appending with \", _jsx(_components.em, {\n        children: \"list.append()\"\n      }), \" takes more time than following code because the function is assigned to a variable (functions are first-class citizens in Python) and used inside the loop. This simple practice avoids referencing the functions with \", _jsx(_components.strong, {\n        children: \"'.'\"\n      }), \" too often and finally limits the need for dictionary lookup.\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-python\",\n        children: \"%%timeit\\nll = []\\nll_append = ll.append\\nfor i in range(len(rand_nums)):\\n    ll_append(rand_nums[i])\\n\"\n      })\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-python:output\",\n        children: \"5.45 ms ± 116 µs per loop (mean ± std. dev. of 7 runs, 100 loops each)\\n\"\n      })\n    }), \"\\n\", _jsx(_components.h3, {\n      children: \"Avoid writing functions unnecessary\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"It's good to have code separability by using functions for each independent task. But, as functions in Python are relatively more expensive than C/C++ due to boxing and unboxing dynamic variables and other factors, limit writing functions for unnecessary cases like one-liners.\"\n    }), \"\\n\", _jsx(_components.h3, {\n      children: \"Don't wrap lambdas around functions\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Overuse or misuse of lambdas is not a good practice. It's common to wrap functions inside lambdas which do the same thing without wrapping.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Consider the following two functions for sorting a list based on absolute values.\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-python\",\n        children: \"def fun_sort_with_lambda(l):\\n    return sorted(l, key=lambda x: abs(x))\\n\\ndef fun_sort_without_lambda(l):\\n    return sorted(l, key=abs)\\n\"\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"If we look at the CPython bytecode for the above functions with lambda expression passed as a key and with \", _jsx(_components.em, {\n        children: \"abs\"\n      }), \" function object as a key,\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-python\",\n        children: \"\u003e\u003e\u003e from dis import dis\\n\u003e\u003e\u003e dis(fun_sort_with_lambda)\\n  2           0 LOAD_GLOBAL              0 (sorted)\\n              2 LOAD_FAST                0 (l)\\n              4 LOAD_CONST               1 (\u003ccode object \u003clambda\u003e at 0x7fc51b3a19d0, file \\\"\u003cipython-input-62-c4147c242c71\u003e\\\", line 2\u003e)\\n              6 LOAD_CONST               2 ('fun_sort_with_lambda.\u003clocals\u003e.\u003clambda\u003e')\\n              8 MAKE_FUNCTION            0\\n             10 LOAD_CONST               3 (('key',))\\n             12 CALL_FUNCTION_KW         2\\n             14 RETURN_VALUE\\n\\nDisassembly of \u003ccode object \u003clambda\u003e at 0x7fc51b3a19d0, file \\\"\u003cipython-input-62-c4147c242c71\u003e\\\", line 2\u003e:\\n  2           0 LOAD_GLOBAL              0 (abs)\\n              2 LOAD_FAST                0 (x)\\n              4 CALL_FUNCTION            1\\n              6 RETURN_VALUE\\n\\n\u003e\u003e\u003e dis(fun_sort_without_lambda)\\n  2           0 LOAD_GLOBAL              0 (sorted)\\n              2 LOAD_FAST                0 (l)\\n              4 LOAD_GLOBAL              1 (abs)\\n              6 LOAD_CONST               1 (('key',))\\n              8 CALL_FUNCTION_KW         2\\n             10 RETURN_VALUE\\n\"\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"for the function \", _jsx(_components.em, {\n        children: \"fun_sort_with_lambda\"\n      }), \", there is an additional function has been generated for lambda. We can avoid this function generation without using lambda as we can see in function \", _jsx(_components.em, {\n        children: \"fun_sort_without_lambda\"\n      }), \".\"]\n    }), \"\\n\", _jsx(_components.h3, {\n      children: \"List comprehension is fast\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"When operating over lists like data structures, list comprehension is faster than traditional methods like looping, functional programming, etc.\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-python\",\n        children: \"%%timeit\\nrand_nums = []\\nfor _ in range(1000):\\n    rand_nums.append(randint(1, 100))\\n\"\n      })\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-output\",\n        children: \"603 µs ± 15.3 µs per loop (mean ± std. dev. of 7 runs, 1000 loops each)\\n\"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"The list comprehension version of the above code snippet runs faster.\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-python:output\",\n        children: \"%%timeit\\nrand_nums = [randint(1, 100) for _ in range(1000)]\\n\"\n      })\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-python:output\",\n        children: \"565 µs ± 11 µs per loop (mean ± std. dev. of 7 runs, 1000 loops each)\\n\"\n      })\n    }), \"\\n\", _jsx(_components.hr, {}), \"\\n\", _jsxs(_components.p, {\n      children: [\"The optimization practices are not limited to the above approaches. We can check how much time it is taking for each line by using libraries like \", _jsx(_components.a, {\n        href: \"https://docs.python.org/3/library/profile.html\",\n        children: \"CProfile\"\n      }), \" and making changes to run faster. In the next blog, we discuss how to improve Python computing efficiency using multiprocessing.\"]\n    }), \"\\n\", _jsx(_components.hr, {}), \"\\n\", _jsx(_components.h3, {\n      children: \"References\"\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsx(_components.li, {\n        children: _jsx(_components.a, {\n          href: \"https://wiki.python.org/moin/PythonSpeed\",\n          children: \"Python Speed\"\n        })\n      }), \"\\n\", _jsx(_components.li, {\n        children: _jsx(_components.a, {\n          href: \"https://aglowiditsolutions.com/blog/python-optimization/\",\n          children: \"Python Optimization\"\n        })\n      }), \"\\n\", _jsx(_components.li, {\n        children: _jsx(_components.a, {\n          href: \"https://martinheinz.dev/blog/13\",\n          children: \"Making Python Programs Blazingly Fast\"\n        })\n      }), \"\\n\"]\n    })]\n  });\n}\nfunction MDXContent(props = {}) {\n  const {wrapper: MDXLayout} = Object.assign({}, _provideComponents(), props.components);\n  return MDXLayout ? _jsx(MDXLayout, Object.assign({}, props, {\n    children: _jsx(_createMdxContent, props)\n  })) : _createMdxContent(props);\n}\nreturn {\n  default: MDXContent\n};\n","frontmatter":{},"scope":{}},"id":"super-fast-python-good-practices"},"__N_SSG":true},"page":"/blog/[id]","query":{"id":"super-fast-python-good-practices"},"buildId":"DPwb1nK7hmgB_yIPdLqpw","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>