<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.4.0/styles/github-dark.min.css"/><meta name="next-head-count" content="3"/><link rel="preload" href="/_next/static/css/35cab027331baf7e.css" as="style"/><link rel="stylesheet" href="/_next/static/css/35cab027331baf7e.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-ee7e63bc15b31913.js" defer=""></script><script src="/_next/static/chunks/framework-2c79e2a64abdb08b.js" defer=""></script><script src="/_next/static/chunks/main-5854f7366a69ea81.js" defer=""></script><script src="/_next/static/chunks/pages/_app-3ca76a984b940bc2.js" defer=""></script><script src="/_next/static/chunks/465-4fe278bcc6195523.js" defer=""></script><script src="/_next/static/chunks/671-33206bff58acfdee.js" defer=""></script><script src="/_next/static/chunks/803-0cdd1b04f7cffd56.js" defer=""></script><script src="/_next/static/chunks/pages/blog/%5Bid%5D-46caa1db85c0b62b.js" defer=""></script><script src="/_next/static/oNnEvNfdL8Qy1aUOO18Eo/_buildManifest.js" defer=""></script><script src="/_next/static/oNnEvNfdL8Qy1aUOO18Eo/_ssgManifest.js" defer=""></script><style id="__jsx-1af872c17140788a">.img-text.jsx-1af872c17140788a{display:block;text-align:center;font-family:"Source Sans Pro",sans-serif;font-size:-webkit-calc(.8rem + .1vw);font-size:-moz-calc(.8rem + .1vw);font-size:calc(.8rem + .1vw);color:#1d2b35;word-wrap:"break-word";overflow-wrap:"break-word"}a.jsx-1af872c17140788a{margin:0;text-decoration:none;color:#1d2b35;border-bottom:1px solid}</style><style id="__jsx-4b699aa219fdc237">.blog-content.jsx-4b699aa219fdc237{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-flex:100%;-webkit-flex:100%;-moz-box-flex:100%;-ms-flex:100%;flex:100%;-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-flex-direction:column;-moz-box-orient:vertical;-moz-box-direction:normal;-ms-flex-direction:column;flex-direction:column;margin:1vw 25vw 1vw 25vw;width:50vw;max-width:50vw}</style></head><body><div id="__next"><header class="Header_header__iG0T4"><div class="flex items-center h-16 px-4"><h2><a class="font-bold text-2xl flex-1" href="/">PressBlog</a></h2><ul><li><a href="/about">About</a></li><li><a href="/blog/whiteboard-image-enhancement-opencv-python#">GitHub Code</a></li></ul></div></header><main><div class="p-4 flex justify-center"><div class="w-11/12 md:w-7/12 prose prose-table"><article class="jsx-4b699aa219fdc237"><p style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);color:#071013f2;margin:0vh 0 1vh 0;overflow-wrap:break-word"><picture class="jsx-1af872c17140788a"><img src="/images/whiteboard-enhance/whiteboard-image-enhancement.jpg" alt="Whiteboard image enhancement in Python" style="width:100%;max-width:100%;height:auto;margin-left:0%" class="jsx-1af872c17140788a"/><span class="jsx-1af872c17140788a img-text"></span></picture></p>
<h1 style="font-family:&#x27;Ubuntu&#x27;, sans-serif;font-size:calc(1rem + 1.5vw);color:#1d2b35;margin:1vh 0 1vh 0;overflow-wrap:break-word" id="">Whiteboard image enhancement using OpenCV</h1>
<p style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);color:#071013f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">Whiteboard images generally contain less contrast and low brightness as they would be captured in mobile under normal room light conditions. Enhancing whiteboard images makes text readable and gives an image with high contrast and brightness.</p>
<p style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);color:#071013f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">We will apply different image-processing techniques to enhance whiteboard images using OpenCV in Python. From this <a style="color:#071013;text-decoration:none;cursor:pointer;border-bottom:1px dashed #fb232e;font-size:calc(1rem + 0.1vw);font-weight:bold;overflow-wrap:break-word" target="_blank" rel="noreferrer" href="https://gist.github.com/lelandbatey/8677901">whiteboard-cleaner</a> gist that enhances whiteboard images using <a style="color:#071013;text-decoration:none;cursor:pointer;border-bottom:1px dashed #fb232e;font-size:calc(1rem + 0.1vw);font-weight:bold;overflow-wrap:break-word" target="_blank" rel="noreferrer" href="https://imagemagick.org/">ImageMagick</a>, we will implement those ImageMagick methods in Python.</p>
<p style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);color:#071013f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">In that script, the following ImageMagick functions were used to enhance whiteboard images</p>
<pre><code class="language-shell">-morphology Convolve DoG:15,100,0 -negate -normalize -blur 0x1 -channel RBG -level 60%,91%,0.1
</code></pre>
<p style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);color:#071013f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">Above command applies image enhancing functions in order</p>
<ul style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);color:#071013e6;margin:1vh 0 1vh calc(2vw);overflow-wrap:break-word">
<li><strong style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);font-style:normal;font-weight:bold;color:#1d2b35f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">-morphology Convolve DoG:15, 100, 0</strong>: Difference of Gaussian (DoG) with kernel_radius=15, sigma1=100, and sigma2=0</li>
<li><strong style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);font-style:normal;font-weight:bold;color:#1d2b35f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">-negate</strong>: Negative of image</li>
<li><strong style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);font-style:normal;font-weight:bold;color:#1d2b35f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">-normalize</strong>: Contrast stretch image with black=0.15% and white=0.05%</li>
<li><strong style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);font-style:normal;font-weight:bold;color:#1d2b35f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">-blur 0x1</strong>: Gaussian blur with sigma=1</li>
<li>**-level 60%,91%,0.1: Stretch image with black=60% and white=91%, and Gamma correction by gamma=0.1</li>
</ul>
<p style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);color:#071013f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">As I found some difficulty for exactly converting the ImageMagick C code to Python, I have changed the order and parameters that would give close results.</p>
<hr style="margin:2vh 25% 2vh 25%;border:1px solid #07101380"/>
<p style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);color:#071013f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">We will apply series of image-processing methods and effects to enhance whiteboard images in the following order</p>
<ul style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);color:#071013e6;margin:1vh 0 1vh calc(2vw);overflow-wrap:break-word">
<li>Difference of Gaussian (DoG)</li>
<li>Negative effect</li>
<li>Contrast Stretching</li>
<li>Gaussian blur</li>
<li>Gamma correction</li>
<li>Color balance</li>
</ul>
<p style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);color:#071013f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">You can find the full code in my Github repository <a style="color:#071013;text-decoration:none;cursor:pointer;border-bottom:1px dashed #fb232e;font-size:calc(1rem + 0.1vw);font-weight:bold;overflow-wrap:break-word" target="_blank" rel="noreferrer" href="https://github.com/santhalakshminarayana/whiteboard-image-enhance">whiteboard-image-enhance</a></p>
<h3 style="font-family:&#x27;Maven Pro&#x27;, sans-serif;font-size:calc(1rem + 0.5vw);color:#1d2b35;margin:1vh 0 1vh 0;overflow-wrap:break-word" id="">Import packages and read image</h3>
<pre><code class="language-python">import cv2
import numpy as np

img = cv2.imread(&#x27;input.jpg&#x27;)
</code></pre>
<p style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);color:#071013f2;margin:0vh 0 1vh 0;overflow-wrap:break-word"><picture class="jsx-1af872c17140788a"><img src="/images/whiteboard-enhance/whiteboard-image.jpg" alt="Whiteboard image input" style="width:70%;max-width:70%;height:auto;margin-left:15%" class="jsx-1af872c17140788a"/><span class="jsx-1af872c17140788a img-text"><span class="jsx-1af872c17140788a">Input Whiteboard image</span></span></picture></p>
<h3 style="font-family:&#x27;Maven Pro&#x27;, sans-serif;font-size:calc(1rem + 0.5vw);color:#1d2b35;margin:1vh 0 1vh 0;overflow-wrap:break-word" id="">Difference of Gaussian (DoG)</h3>
<p style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);color:#071013f2;margin:0vh 0 1vh 0;overflow-wrap:break-word"><a style="color:#071013;text-decoration:none;cursor:pointer;border-bottom:1px dashed #fb232e;font-size:calc(1rem + 0.1vw);font-weight:bold;overflow-wrap:break-word" target="_blank" rel="noreferrer" href="https://en.wikipedia.org/wiki/Difference_of_Gaussians">Difference of Gaussians (DoG)</a> is the difference of two Gaussian kernel convoluted images. DoG image is obtained by subtracting two Gaussian blurred images with different kernel radius and variance.</p>
<p style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);color:#071013f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">Normally <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>I</mi><mrow><mi>d</mi><mi>o</mi><mi>g</mi></mrow></msub></mrow><annotation encoding="application/x-tex">I_{dog}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em"><span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">d</span><span class="mord mathnormal mtight">o</span><span class="mord mathnormal mtight" style="margin-right:0.03588em">g</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em"><span></span></span></span></span></span></span></span></span></span></span> (DoG of image) is calculated by subtracting <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>I</mi><mrow><mi>g</mi><mn>1</mn></mrow></msub></mrow><annotation encoding="application/x-tex">I_{g1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em">g</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em"><span></span></span></span></span></span></span></span></span></span></span> and <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>I</mi><mrow><mi>g</mi><mn>2</mn></mrow></msub></mrow><annotation encoding="application/x-tex">I_{g2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em">g</span><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em"><span></span></span></span></span></span></span></span></span></span></span> which are convoluted images with two different Gaussian kernels. But ImageMagick applies convolution after subtracting and scaling two gaussian kernels.</p>
<p style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);color:#071013f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">So, we will first subtract two different Gaussian kernels, scale and normalize the dog-kernel to the zero-summing kernel (sum of all elements ~ 0.0)  and then apply convolution.</p>
<pre><code class="language-python">def normalize_kernel(kernel, k_width, k_height, scaling_factor = 1.0):
    &#x27;&#x27;&#x27;Zero-summing normalize kernel&#x27;&#x27;&#x27;
    
    K_EPS = 1.0e-12
    # positive and negative sum of kernel values
    pos_range, neg_range = 0, 0
    for i in range(k_width * k_height):
        if abs(kernel[i]) &lt; K_EPS:
            kernel[i] = 0.0
        if kernel[i] &lt; 0:
            neg_range += kernel[i]
        else:
            pos_range += kernel[i]
    
    # scaling factor for positive and negative range
    pos_scale, neg_scale = pos_range, -neg_range
    if abs(pos_range) &gt;= K_EPS:
        pos_scale = pos_range
    else:
        pos_sacle = 1.0
    if abs(neg_range) &gt;= K_EPS:
        neg_scale = 1.0
    else:
        neg_scale = -neg_range
        
    pos_scale = scaling_factor / pos_scale
    neg_scale = scaling_factor / neg_scale
    
    # scale kernel values for zero-summing kernel
    for i in range(k_width * k_height):
        if (not np.nan == kernel[i]):
            kernel[i] *= pos_scale if kernel[i] &gt;= 0 else neg_scale
            
    return kernel

def dog(img, k_size, sigma_1, sigma_2):
    &#x27;&#x27;&#x27;Difference of Gaussian by subtracting kernel 1 and kernel 2&#x27;&#x27;&#x27;
    
    k_width = k_height = k_size
    x = y = (k_width - 1) // 2
    kernel = np.zeros(k_width * k_height)
    
    # first gaussian kernal
    if sigma_1 &gt; 0:
        co_1 = 1 / (2 * sigma_1 * sigma_1)
        co_2 = 1 / (2 * np.pi * sigma_1 * sigma_1)
        i = 0
        for v in range(-y, y + 1):
            for u in range(-x, x + 1):
                kernel[i] = np.exp(-(u*u + v*v) * co_1) * co_2
                i += 1
    # unity kernel
    else:
        kernel[x + y * k_width] = 1.0
    
    # subtract second gaussian from kernel
    if sigma_2 &gt; 0:
        co_1 = 1 / (2 * sigma_2 * sigma_2)
        co_2 = 1 / (2 * np.pi * sigma_2 * sigma_2)
        i = 0
        for v in range(-y, y + 1):
            for u in range(-x, x + 1):
                kernel[i] -= np.exp(-(u*u + v*v) * co_1) * co_2
                i += 1
    # unity kernel
    else:
        kernel[x + y * k_width] -= 1.0
    
    # zero-normalize scling kernel with scaling factor 1.0
    norm_kernel = normalize_kernel(kernel, k_width, k_height, scaling_factor = 1.0)
    
    # apply filter with norm_kernel
    return cv2.filter2D(img, -1, norm_kernel.reshape(k_width, k_height))
</code></pre>
<p style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);color:#071013f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">Get Difference of Gaussian (DoG) for image by calling <em style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);font-style:normal;background-color:#07101326;color:#071013f2;margin:0vh 0 1vh 0;padding:0 2px 0 2px;border-radius:2px">dog()</em> function with <strong style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);font-style:normal;font-weight:bold;color:#1d2b35f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">radius = 15, sigma_1 = 100, sigma_2 = 0</strong>. Here <strong style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);font-style:normal;font-weight:bold;color:#1d2b35f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">radius = 15</strong> for both kernels, for first kernel, <strong style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);font-style:normal;font-weight:bold;color:#1d2b35f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">sigma = 100</strong>, and for second kernel, <strong style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);font-style:normal;font-weight:bold;color:#1d2b35f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">sigma = 0</strong>. Kernel with <strong style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);font-style:normal;font-weight:bold;color:#1d2b35f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">sigma = 0</strong> creates unity kernel means convolution with this kernel gives same image.</p>
<pre><code class="language-python">dog_img = dog(img, 15, 100, 0)
</code></pre>
<p style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);color:#071013f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">After applying DoG, the resultant image looks like</p>
<p style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);color:#071013f2;margin:0vh 0 1vh 0;overflow-wrap:break-word"><picture class="jsx-1af872c17140788a"><img src="/images/whiteboard-enhance/difference-of-gaussian.jpg" alt="Difference of Gaussian (DoG) Image" style="width:70%;max-width:70%;height:auto;margin-left:15%" class="jsx-1af872c17140788a"/><span class="jsx-1af872c17140788a img-text"><span class="jsx-1af872c17140788a">Difference of Gaussian (DoG) image</span></span></picture></p>
<hr style="margin:2vh 25% 2vh 25%;border:1px solid #07101380"/>
<h3 style="font-family:&#x27;Maven Pro&#x27;, sans-serif;font-size:calc(1rem + 0.5vw);color:#1d2b35;margin:1vh 0 1vh 0;overflow-wrap:break-word" id="">Negative Image</h3>
<p style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);color:#071013f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">For <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>I</mi><mrow><mi>d</mi><mi>o</mi><mi>g</mi></mrow></msub></mrow><annotation encoding="application/x-tex">I_{dog}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em"><span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">d</span><span class="mord mathnormal mtight">o</span><span class="mord mathnormal mtight" style="margin-right:0.03588em">g</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em"><span></span></span></span></span></span></span></span></span></span></span>, get a negative image which is just an inversion of colors (255 - image).</p>
<pre><code class="language-python">def negate(img):
    &#x27;&#x27;&#x27;Negative of image&#x27;&#x27;&#x27;
    
    return cv2.bitwise_not(img)
</code></pre>
<pre><code class="language-python">negative_img = negate(dog_img)
</code></pre>
<p style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);color:#071013f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">The result of the inversion image is
<picture class="jsx-1af872c17140788a"><img src="/images/whiteboard-enhance/negative.jpg" alt="Negative image" style="width:70%;max-width:70%;height:auto;margin-left:15%" class="jsx-1af872c17140788a"/><span class="jsx-1af872c17140788a img-text"><span class="jsx-1af872c17140788a">Negative image</span></span></picture></p>
<p style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);color:#071013f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">Image content is not much visible as we inverted an image whose most of the pixels are black. So, to improve the contrast, we apply contrast-stretch enhancement for the negative image.</p>
<hr style="margin:2vh 25% 2vh 25%;border:1px solid #07101380"/>
<h3 style="font-family:&#x27;Maven Pro&#x27;, sans-serif;font-size:calc(1rem + 0.5vw);color:#1d2b35;margin:1vh 0 1vh 0;overflow-wrap:break-word" id="">Contrast Stretching</h3>
<p style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);color:#071013f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">Contrast stretching of an image is the same as histogram equalization but we cap some percentage of pixel values to black (0) and white (255).</p>
<pre><code class="language-python">def get_black_white_indices(hist, tot_count, black_count, white_count):
    &#x27;&#x27;&#x27;Blacking and Whiting out indices same as color balance&#x27;&#x27;&#x27;

    black_ind = 0
    white_ind = 255
    co = 0
    for i in range(len(hist)):
        co += hist[i]
        if co &gt; black_count:
            black_ind = i
            break
            
    co = 0
    for i in range(len(hist) - 1, -1, -1):
        co += hist[i]
        if co &gt; (tot_count - white_count):
            white_ind = i
            break
    
    return [black_ind, white_ind]

def contrast_stretch(img, black_point, white_point):
    &#x27;&#x27;&#x27;Contrast stretch image with black and white cap&#x27;&#x27;&#x27;
    
    tot_count = img.shape[0] * img.shape[1]
    black_count = tot_count * black_point / 100
    white_count= tot_count * white_point / 100
    ch_hists = []
    # calculate histogram for each channel
    for ch in cv2.split(img):
        ch_hists.append(cv2.calcHist([ch], [0], None, [256], (0, 256)).flatten().tolist())
    
    # get black and white percentage indices
    black_white_indices = []
    for hist in ch_hists:
        black_white_indices.append(get_black_white_indices(hist, tot_count, black_count, white_count))
        
    stretch_map = np.zeros((3, 256), dtype = &#x27;uint8&#x27;)
    
    # stretch histogram 
    for curr_ch in range(len(black_white_indices)):
        black_ind, white_ind = black_white_indices[curr_ch]
        for i in range(stretch_map.shape[1]):
            if i &lt; black_ind:
                stretch_map[curr_ch][i] = 0
            else:
                if i &gt; white_ind:
                    stretch_map[curr_ch][i] = 255
                else:
                    if (white_ind - black_ind) &gt; 0:
                        stretch_map[curr_ch][i] = round((i - black_ind) / (white_ind - black_ind)) * 255
                    else:
                        stretch_map[curr_ch][i] = 0
    
    # stretch image
    ch_stretch = []
    for i, ch in enumerate(cv2.split(img)):
        ch_stretch.append(cv2.LUT(ch, stretch_map[i]))
        
    return cv2.merge(ch_stretch)
</code></pre>
<p style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);color:#071013f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">For each image channel, calculate cummulative histogram sum, and then cap pixels based on <strong style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);font-style:normal;font-weight:bold;color:#1d2b35f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">black_point = 2</strong> and <strong style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);font-style:normal;font-weight:bold;color:#1d2b35f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">white_point = 99.5</strong> percentage.</p>
<pre><code class="language-python">contrast_stretch_img = contrast_stretch(negative_img, 2, 99.5)
</code></pre>
<p style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);color:#071013f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">Negative image after contrast stretching is</p>
<p style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);color:#071013f2;margin:0vh 0 1vh 0;overflow-wrap:break-word"><picture class="jsx-1af872c17140788a"><img src="/images/whiteboard-enhance/contrast-stretch.jpg" alt="Contrast stretch image" style="width:70%;max-width:70%;height:auto;margin-left:15%" class="jsx-1af872c17140788a"/><span class="jsx-1af872c17140788a img-text"><span class="jsx-1af872c17140788a">Contrast strech image</span></span></picture></p>
<hr style="margin:2vh 25% 2vh 25%;border:1px solid #07101380"/>
<h3 style="font-family:&#x27;Maven Pro&#x27;, sans-serif;font-size:calc(1rem + 0.5vw);color:#1d2b35;margin:1vh 0 1vh 0;overflow-wrap:break-word" id="">Gaussin Blur &amp; Gamma Correction</h3>
<p style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);color:#071013f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">Contrast stretching image contains noise, so blur the image with Gaussian kernel. As Gaussian distribution kernel can be linearly separable, we apply convolution with the same 1D-kernel along the x-axis and y-axis for performance (negligible for small kernels and low-res images).</p>
<pre><code class="language-python">def fast_gaussian_blur(img, ksize, sigma):
    &#x27;&#x27;&#x27;Gussian blur using linear separable property of Gaussian distribution&#x27;&#x27;&#x27;
    
    kernel_1d = cv2.getGaussianKernel(ksize, sigma)
    return cv2.sepFilter2D(img, -1, kernel_1d, kernel_1d)

def gamma(img, gamma_value):
    &#x27;&#x27;&#x27;Gamma correction of image&#x27;&#x27;&#x27;
    
    i_gamma = 1 / gamma_value
    lut = np.array([((i / 255) ** i_gamma) * 255 for i in np.arange(0, 256)], dtype = &#x27;uint8&#x27;)
    return cv2.LUT(img, lut)
</code></pre>
<p style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);color:#071013f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">Apply Gaussian blur with <strong style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);font-style:normal;font-weight:bold;color:#1d2b35f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">kernel_size = 3</strong> and <strong style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);font-style:normal;font-weight:bold;color:#1d2b35f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">sigma = 1</strong>.</p>
<pre><code class="language-python">blur_img = fast_gaussian_blur(contrast_stretch_img, 3, 1)
</code></pre>
<p style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);color:#071013f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">Blurred image after noise suppression is</p>
<p style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);color:#071013f2;margin:0vh 0 1vh 0;overflow-wrap:break-word"><picture class="jsx-1af872c17140788a"><img src="/images/whiteboard-enhance/gaussian-blur.jpg" alt="Gaussian blur image" style="width:70%;max-width:70%;height:auto;margin-left:15%" class="jsx-1af872c17140788a"/><span class="jsx-1af872c17140788a img-text"><span class="jsx-1af872c17140788a">Blurred image</span></span></picture></p>
<p style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);color:#071013f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">Now apply Gamma correction to enhance the blurred image with <strong style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);font-style:normal;font-weight:bold;color:#1d2b35f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">gamma_value = 1.1</strong>.</p>
<pre><code class="language-python">gamma_img = gamma(blur_img, 1.1)
</code></pre>
<p style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);color:#071013f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">Blurred image Gamma corrected looks like</p>
<p style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);color:#071013f2;margin:0vh 0 1vh 0;overflow-wrap:break-word"><picture class="jsx-1af872c17140788a"><img src="/images/whiteboard-enhance/gamma-correction.jpg" alt="Gamma correction" style="width:70%;max-width:70%;height:auto;margin-left:15%" class="jsx-1af872c17140788a"/><span class="jsx-1af872c17140788a img-text"><span class="jsx-1af872c17140788a">Gamma corrected image</span></span></picture></p>
<hr style="margin:2vh 25% 2vh 25%;border:1px solid #07101380"/>
<h3 style="font-family:&#x27;Maven Pro&#x27;, sans-serif;font-size:calc(1rem + 0.5vw);color:#1d2b35;margin:1vh 0 1vh 0;overflow-wrap:break-word" id="">Color Balance</h3>
<p style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);color:#071013f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">Color balance of an image is same as contrast-stretching method above but they are different in implementation. Above contrast-stretching is an implementation based on <a style="color:#071013;text-decoration:none;cursor:pointer;border-bottom:1px dashed #fb232e;font-size:calc(1rem + 0.1vw);font-weight:bold;overflow-wrap:break-word" target="_blank" rel="noreferrer" href="https://imagemagick.org/api/MagickCore/enhance_8c.html">ImageMagick-ContrastStretchImage()</a>, and <a style="color:#071013;text-decoration:none;cursor:pointer;border-bottom:1px dashed #fb232e;font-size:calc(1rem + 0.1vw);font-weight:bold;overflow-wrap:break-word" target="_blank" rel="noreferrer" href="https://gist.github.com/DavidYKay/9dad6c4ab0d8d7dbf3dc">color balance</a> is based on <a style="color:#071013;text-decoration:none;cursor:pointer;border-bottom:1px dashed #fb232e;font-size:calc(1rem + 0.1vw);font-weight:bold;overflow-wrap:break-word" target="_blank" rel="noreferrer" href="https://www.ipol.im/pub/art/2011/llmps-scb/article.pdf">Simplest Color Balance</a>.</p>
<pre><code class="language-python">def color_balance(img, low_per, high_per):
    &#x27;&#x27;&#x27;Contrast stretch image by histogram equilization with black and white cap&#x27;&#x27;&#x27;
    
    tot_pix = img.shape[1] * img.shape[0]
    # no.of pixels to black-out and white-out
    low_count = tot_pix * low_per / 100
    high_count = tot_pix * (100 - high_per) / 100
    
    cs_img = []
    # for each channel, apply contrast-stretch
    for ch in cv2.split(img):
        # cummulative histogram sum of channel
        cum_hist_sum = np.cumsum(cv2.calcHist([ch], [0], None, [256], (0, 256)))

        # find indices for blacking and whiting out pixels
        li, hi = np.searchsorted(cum_hist_sum, (low_count, high_count))
        if (li == hi):
            cs_img.append(ch)
            continue
        # lut with min-max normalization for [0-255] bins
        lut = np.array([0 if i &lt; li 
                        else (255 if i &gt; hi else round((i - li) / (hi - li) * 255)) 
                        for i in np.arange(0, 256)], dtype = &#x27;uint8&#x27;)
        # constrast-stretch channel
        cs_ch = cv2.LUT(ch, lut)
        cs_img.append(cs_ch)
        
    return cv2.merge(cs_img)
</code></pre>
<p style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);color:#071013f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">Enhance image by passing Gamma corrected image to <strong style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);font-style:normal;font-weight:bold;color:#1d2b35f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">color_balance()</strong> with parameters <strong style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);font-style:normal;font-weight:bold;color:#1d2b35f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">low_per = 2</strong> and <strong style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);font-style:normal;font-weight:bold;color:#1d2b35f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">high_per = 1</strong>.</p>
<pre><code class="language-python">color_balanced_img = color_balance(gamma_img, 2, 1)
</code></pre>
<p style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);color:#071013f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">The final enhanced whiteboard image is
<picture class="jsx-1af872c17140788a"><img src="/images/whiteboard-enhance/whiteboard-image-enhanced.jpg" alt="Whiteboard image enhance" style="width:70%;max-width:70%;height:auto;margin-left:15%" class="jsx-1af872c17140788a"/><span class="jsx-1af872c17140788a img-text"><span class="jsx-1af872c17140788a">Whiteboard image enhanced</span></span></picture></p>
<p style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);color:#071013f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">You can find out full code at my Github repository file <a style="color:#071013;text-decoration:none;cursor:pointer;border-bottom:1px dashed #fb232e;font-size:calc(1rem + 0.1vw);font-weight:bold;overflow-wrap:break-word" target="_blank" rel="noreferrer" href="https://github.com/santhalakshminarayana/whiteboard-image-enhance/blob/main/whiteboard_image_enhance.py">whiteboard_image_enhance.py</a></p>
<hr style="margin:2vh 25% 2vh 25%;border:1px solid #07101380"/>
<h2 style="font-family:&#x27;Maven Pro&#x27;, sans-serif;font-size:calc(1rem + 1vw);color:#1d2b35;margin:1vh 0 1vh 0;overflow-wrap:break-word" id="">Results</h2>
<p style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);color:#071013f2;margin:0vh 0 1vh 0;overflow-wrap:break-word"><picture class="jsx-1af872c17140788a"><img src="/images/whiteboard-enhance/img_2.jpg" alt="img_2" style="width:100%;max-width:100%;height:auto;margin-left:0%" class="jsx-1af872c17140788a"/><span class="jsx-1af872c17140788a img-text"></span></picture></p>
<p style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);color:#071013f2;margin:0vh 0 1vh 0;overflow-wrap:break-word"><picture class="jsx-1af872c17140788a"><img src="/images/whiteboard-enhance/img_3.jpg" alt="img_3" style="width:100%;max-width:100%;height:auto;margin-left:0%" class="jsx-1af872c17140788a"/><span class="jsx-1af872c17140788a img-text"></span></picture></p>
<p style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);color:#071013f2;margin:0vh 0 1vh 0;overflow-wrap:break-word"><picture class="jsx-1af872c17140788a"><img src="/images/whiteboard-enhance/img_4.jpg" alt="img_4" style="width:100%;max-width:100%;height:auto;margin-left:0%" class="jsx-1af872c17140788a"/><span class="jsx-1af872c17140788a img-text"></span></picture></p></article></div></div></main></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"postMetadata":{"title":"Whiteboard Image Enhancement using OpenCV","description":"Enhance whiteboard images taken from mobile using OpenCV.","imgName":"whiteboard-enhance/whiteboard-image-enhancement.jpg","date":"Oct 19, 2021","tags":["image-processing","opencv"],"keywords":["whiteboard","whiteboard-enhance","image-enhance","image-processing","opencv","python","difference-of-guassian","dog","contrast-stretch","color-balance"],"id":"whiteboard-image-enhancement-opencv-python"},"postContent":{"compiledSource":"/*@jsxRuntime automatic @jsxImportSource react*/\nconst {Fragment: _Fragment, jsx: _jsx, jsxs: _jsxs} = arguments[0];\nconst {useMDXComponents: _provideComponents} = arguments[0];\nfunction _createMdxContent(props) {\n  const _components = Object.assign({\n    p: \"p\",\n    img: \"img\",\n    h1: \"h1\",\n    a: \"a\",\n    pre: \"pre\",\n    code: \"code\",\n    ul: \"ul\",\n    li: \"li\",\n    strong: \"strong\",\n    hr: \"hr\",\n    h3: \"h3\",\n    span: \"span\",\n    math: \"math\",\n    semantics: \"semantics\",\n    mrow: \"mrow\",\n    msub: \"msub\",\n    mi: \"mi\",\n    annotation: \"annotation\",\n    mn: \"mn\",\n    em: \"em\",\n    h2: \"h2\"\n  }, _provideComponents(), props.components);\n  return _jsxs(_Fragment, {\n    children: [_jsx(_components.p, {\n      children: _jsx(_components.img, {\n        src: \"whiteboard-enhance/whiteboard-image-enhancement.jpg\",\n        alt: \"Whiteboard image enhancement in Python\"\n      })\n    }), \"\\n\", _jsx(_components.h1, {\n      children: \"Whiteboard image enhancement using OpenCV\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Whiteboard images generally contain less contrast and low brightness as they would be captured in mobile under normal room light conditions. Enhancing whiteboard images makes text readable and gives an image with high contrast and brightness.\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"We will apply different image-processing techniques to enhance whiteboard images using OpenCV in Python. From this \", _jsx(_components.a, {\n        href: \"https://gist.github.com/lelandbatey/8677901\",\n        children: \"whiteboard-cleaner\"\n      }), \" gist that enhances whiteboard images using \", _jsx(_components.a, {\n        href: \"https://imagemagick.org/\",\n        children: \"ImageMagick\"\n      }), \", we will implement those ImageMagick methods in Python.\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"In that script, the following ImageMagick functions were used to enhance whiteboard images\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-shell\",\n        children: \"-morphology Convolve DoG:15,100,0 -negate -normalize -blur 0x1 -channel RBG -level 60%,91%,0.1\\n\"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Above command applies image enhancing functions in order\"\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsxs(_components.li, {\n        children: [_jsx(_components.strong, {\n          children: \"-morphology Convolve DoG:15, 100, 0\"\n        }), \": Difference of Gaussian (DoG) with kernel_radius=15, sigma1=100, and sigma2=0\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [_jsx(_components.strong, {\n          children: \"-negate\"\n        }), \": Negative of image\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [_jsx(_components.strong, {\n          children: \"-normalize\"\n        }), \": Contrast stretch image with black=0.15% and white=0.05%\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [_jsx(_components.strong, {\n          children: \"-blur 0x1\"\n        }), \": Gaussian blur with sigma=1\"]\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"**-level 60%,91%,0.1: Stretch image with black=60% and white=91%, and Gamma correction by gamma=0.1\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"As I found some difficulty for exactly converting the ImageMagick C code to Python, I have changed the order and parameters that would give close results.\"\n    }), \"\\n\", _jsx(_components.hr, {}), \"\\n\", _jsx(_components.p, {\n      children: \"We will apply series of image-processing methods and effects to enhance whiteboard images in the following order\"\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsx(_components.li, {\n        children: \"Difference of Gaussian (DoG)\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"Negative effect\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"Contrast Stretching\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"Gaussian blur\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"Gamma correction\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"Color balance\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"You can find the full code in my Github repository \", _jsx(_components.a, {\n        href: \"https://github.com/santhalakshminarayana/whiteboard-image-enhance\",\n        children: \"whiteboard-image-enhance\"\n      })]\n    }), \"\\n\", _jsx(_components.h3, {\n      children: \"Import packages and read image\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-python\",\n        children: \"import cv2\\nimport numpy as np\\n\\nimg = cv2.imread('input.jpg')\\n\"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: _jsx(_components.img, {\n        src: \"whiteboard-enhance/whiteboard-image.jpg\",\n        alt: \"Whiteboard image input:=:70:=:Input Whiteboard image\"\n      })\n    }), \"\\n\", _jsx(_components.h3, {\n      children: \"Difference of Gaussian (DoG)\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [_jsx(_components.a, {\n        href: \"https://en.wikipedia.org/wiki/Difference_of_Gaussians\",\n        children: \"Difference of Gaussians (DoG)\"\n      }), \" is the difference of two Gaussian kernel convoluted images. DoG image is obtained by subtracting two Gaussian blurred images with different kernel radius and variance.\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Normally \", _jsx(_components.span, {\n        className: \"math math-inline\",\n        children: _jsxs(_components.span, {\n          className: \"katex\",\n          children: [_jsx(_components.span, {\n            className: \"katex-mathml\",\n            children: _jsx(_components.math, {\n              xmlns: \"http://www.w3.org/1998/Math/MathML\",\n              children: _jsxs(_components.semantics, {\n                children: [_jsx(_components.mrow, {\n                  children: _jsxs(_components.msub, {\n                    children: [_jsx(_components.mi, {\n                      children: \"I\"\n                    }), _jsxs(_components.mrow, {\n                      children: [_jsx(_components.mi, {\n                        children: \"d\"\n                      }), _jsx(_components.mi, {\n                        children: \"o\"\n                      }), _jsx(_components.mi, {\n                        children: \"g\"\n                      })]\n                    })]\n                  })\n                }), _jsx(_components.annotation, {\n                  encoding: \"application/x-tex\",\n                  children: \"I_{dog}\"\n                })]\n              })\n            })\n          }), _jsx(_components.span, {\n            className: \"katex-html\",\n            \"aria-hidden\": \"true\",\n            children: _jsxs(_components.span, {\n              className: \"base\",\n              children: [_jsx(_components.span, {\n                className: \"strut\",\n                style: {\n                  height: \"0.9694em\",\n                  verticalAlign: \"-0.2861em\"\n                }\n              }), _jsxs(_components.span, {\n                className: \"mord\",\n                children: [_jsx(_components.span, {\n                  className: \"mord mathnormal\",\n                  style: {\n                    marginRight: \"0.07847em\"\n                  },\n                  children: \"I\"\n                }), _jsx(_components.span, {\n                  className: \"msupsub\",\n                  children: _jsxs(_components.span, {\n                    className: \"vlist-t vlist-t2\",\n                    children: [_jsxs(_components.span, {\n                      className: \"vlist-r\",\n                      children: [_jsx(_components.span, {\n                        className: \"vlist\",\n                        style: {\n                          height: \"0.3361em\"\n                        },\n                        children: _jsxs(_components.span, {\n                          style: {\n                            top: \"-2.55em\",\n                            marginLeft: \"-0.0785em\",\n                            marginRight: \"0.05em\"\n                          },\n                          children: [_jsx(_components.span, {\n                            className: \"pstrut\",\n                            style: {\n                              height: \"2.7em\"\n                            }\n                          }), _jsx(_components.span, {\n                            className: \"sizing reset-size6 size3 mtight\",\n                            children: _jsxs(_components.span, {\n                              className: \"mord mtight\",\n                              children: [_jsx(_components.span, {\n                                className: \"mord mathnormal mtight\",\n                                children: \"d\"\n                              }), _jsx(_components.span, {\n                                className: \"mord mathnormal mtight\",\n                                children: \"o\"\n                              }), _jsx(_components.span, {\n                                className: \"mord mathnormal mtight\",\n                                style: {\n                                  marginRight: \"0.03588em\"\n                                },\n                                children: \"g\"\n                              })]\n                            })\n                          })]\n                        })\n                      }), _jsx(_components.span, {\n                        className: \"vlist-s\",\n                        children: \"​\"\n                      })]\n                    }), _jsx(_components.span, {\n                      className: \"vlist-r\",\n                      children: _jsx(_components.span, {\n                        className: \"vlist\",\n                        style: {\n                          height: \"0.2861em\"\n                        },\n                        children: _jsx(_components.span, {})\n                      })\n                    })]\n                  })\n                })]\n              })]\n            })\n          })]\n        })\n      }), \" (DoG of image) is calculated by subtracting \", _jsx(_components.span, {\n        className: \"math math-inline\",\n        children: _jsxs(_components.span, {\n          className: \"katex\",\n          children: [_jsx(_components.span, {\n            className: \"katex-mathml\",\n            children: _jsx(_components.math, {\n              xmlns: \"http://www.w3.org/1998/Math/MathML\",\n              children: _jsxs(_components.semantics, {\n                children: [_jsx(_components.mrow, {\n                  children: _jsxs(_components.msub, {\n                    children: [_jsx(_components.mi, {\n                      children: \"I\"\n                    }), _jsxs(_components.mrow, {\n                      children: [_jsx(_components.mi, {\n                        children: \"g\"\n                      }), _jsx(_components.mn, {\n                        children: \"1\"\n                      })]\n                    })]\n                  })\n                }), _jsx(_components.annotation, {\n                  encoding: \"application/x-tex\",\n                  children: \"I_{g1}\"\n                })]\n              })\n            })\n          }), _jsx(_components.span, {\n            className: \"katex-html\",\n            \"aria-hidden\": \"true\",\n            children: _jsxs(_components.span, {\n              className: \"base\",\n              children: [_jsx(_components.span, {\n                className: \"strut\",\n                style: {\n                  height: \"0.9694em\",\n                  verticalAlign: \"-0.2861em\"\n                }\n              }), _jsxs(_components.span, {\n                className: \"mord\",\n                children: [_jsx(_components.span, {\n                  className: \"mord mathnormal\",\n                  style: {\n                    marginRight: \"0.07847em\"\n                  },\n                  children: \"I\"\n                }), _jsx(_components.span, {\n                  className: \"msupsub\",\n                  children: _jsxs(_components.span, {\n                    className: \"vlist-t vlist-t2\",\n                    children: [_jsxs(_components.span, {\n                      className: \"vlist-r\",\n                      children: [_jsx(_components.span, {\n                        className: \"vlist\",\n                        style: {\n                          height: \"0.3011em\"\n                        },\n                        children: _jsxs(_components.span, {\n                          style: {\n                            top: \"-2.55em\",\n                            marginLeft: \"-0.0785em\",\n                            marginRight: \"0.05em\"\n                          },\n                          children: [_jsx(_components.span, {\n                            className: \"pstrut\",\n                            style: {\n                              height: \"2.7em\"\n                            }\n                          }), _jsx(_components.span, {\n                            className: \"sizing reset-size6 size3 mtight\",\n                            children: _jsxs(_components.span, {\n                              className: \"mord mtight\",\n                              children: [_jsx(_components.span, {\n                                className: \"mord mathnormal mtight\",\n                                style: {\n                                  marginRight: \"0.03588em\"\n                                },\n                                children: \"g\"\n                              }), _jsx(_components.span, {\n                                className: \"mord mtight\",\n                                children: \"1\"\n                              })]\n                            })\n                          })]\n                        })\n                      }), _jsx(_components.span, {\n                        className: \"vlist-s\",\n                        children: \"​\"\n                      })]\n                    }), _jsx(_components.span, {\n                      className: \"vlist-r\",\n                      children: _jsx(_components.span, {\n                        className: \"vlist\",\n                        style: {\n                          height: \"0.2861em\"\n                        },\n                        children: _jsx(_components.span, {})\n                      })\n                    })]\n                  })\n                })]\n              })]\n            })\n          })]\n        })\n      }), \" and \", _jsx(_components.span, {\n        className: \"math math-inline\",\n        children: _jsxs(_components.span, {\n          className: \"katex\",\n          children: [_jsx(_components.span, {\n            className: \"katex-mathml\",\n            children: _jsx(_components.math, {\n              xmlns: \"http://www.w3.org/1998/Math/MathML\",\n              children: _jsxs(_components.semantics, {\n                children: [_jsx(_components.mrow, {\n                  children: _jsxs(_components.msub, {\n                    children: [_jsx(_components.mi, {\n                      children: \"I\"\n                    }), _jsxs(_components.mrow, {\n                      children: [_jsx(_components.mi, {\n                        children: \"g\"\n                      }), _jsx(_components.mn, {\n                        children: \"2\"\n                      })]\n                    })]\n                  })\n                }), _jsx(_components.annotation, {\n                  encoding: \"application/x-tex\",\n                  children: \"I_{g2}\"\n                })]\n              })\n            })\n          }), _jsx(_components.span, {\n            className: \"katex-html\",\n            \"aria-hidden\": \"true\",\n            children: _jsxs(_components.span, {\n              className: \"base\",\n              children: [_jsx(_components.span, {\n                className: \"strut\",\n                style: {\n                  height: \"0.9694em\",\n                  verticalAlign: \"-0.2861em\"\n                }\n              }), _jsxs(_components.span, {\n                className: \"mord\",\n                children: [_jsx(_components.span, {\n                  className: \"mord mathnormal\",\n                  style: {\n                    marginRight: \"0.07847em\"\n                  },\n                  children: \"I\"\n                }), _jsx(_components.span, {\n                  className: \"msupsub\",\n                  children: _jsxs(_components.span, {\n                    className: \"vlist-t vlist-t2\",\n                    children: [_jsxs(_components.span, {\n                      className: \"vlist-r\",\n                      children: [_jsx(_components.span, {\n                        className: \"vlist\",\n                        style: {\n                          height: \"0.3011em\"\n                        },\n                        children: _jsxs(_components.span, {\n                          style: {\n                            top: \"-2.55em\",\n                            marginLeft: \"-0.0785em\",\n                            marginRight: \"0.05em\"\n                          },\n                          children: [_jsx(_components.span, {\n                            className: \"pstrut\",\n                            style: {\n                              height: \"2.7em\"\n                            }\n                          }), _jsx(_components.span, {\n                            className: \"sizing reset-size6 size3 mtight\",\n                            children: _jsxs(_components.span, {\n                              className: \"mord mtight\",\n                              children: [_jsx(_components.span, {\n                                className: \"mord mathnormal mtight\",\n                                style: {\n                                  marginRight: \"0.03588em\"\n                                },\n                                children: \"g\"\n                              }), _jsx(_components.span, {\n                                className: \"mord mtight\",\n                                children: \"2\"\n                              })]\n                            })\n                          })]\n                        })\n                      }), _jsx(_components.span, {\n                        className: \"vlist-s\",\n                        children: \"​\"\n                      })]\n                    }), _jsx(_components.span, {\n                      className: \"vlist-r\",\n                      children: _jsx(_components.span, {\n                        className: \"vlist\",\n                        style: {\n                          height: \"0.2861em\"\n                        },\n                        children: _jsx(_components.span, {})\n                      })\n                    })]\n                  })\n                })]\n              })]\n            })\n          })]\n        })\n      }), \" which are convoluted images with two different Gaussian kernels. But ImageMagick applies convolution after subtracting and scaling two gaussian kernels.\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"So, we will first subtract two different Gaussian kernels, scale and normalize the dog-kernel to the zero-summing kernel (sum of all elements ~ 0.0)  and then apply convolution.\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-python\",\n        children: \"def normalize_kernel(kernel, k_width, k_height, scaling_factor = 1.0):\\n    '''Zero-summing normalize kernel'''\\n    \\n    K_EPS = 1.0e-12\\n    # positive and negative sum of kernel values\\n    pos_range, neg_range = 0, 0\\n    for i in range(k_width * k_height):\\n        if abs(kernel[i]) \u003c K_EPS:\\n            kernel[i] = 0.0\\n        if kernel[i] \u003c 0:\\n            neg_range += kernel[i]\\n        else:\\n            pos_range += kernel[i]\\n    \\n    # scaling factor for positive and negative range\\n    pos_scale, neg_scale = pos_range, -neg_range\\n    if abs(pos_range) \u003e= K_EPS:\\n        pos_scale = pos_range\\n    else:\\n        pos_sacle = 1.0\\n    if abs(neg_range) \u003e= K_EPS:\\n        neg_scale = 1.0\\n    else:\\n        neg_scale = -neg_range\\n        \\n    pos_scale = scaling_factor / pos_scale\\n    neg_scale = scaling_factor / neg_scale\\n    \\n    # scale kernel values for zero-summing kernel\\n    for i in range(k_width * k_height):\\n        if (not np.nan == kernel[i]):\\n            kernel[i] *= pos_scale if kernel[i] \u003e= 0 else neg_scale\\n            \\n    return kernel\\n\\ndef dog(img, k_size, sigma_1, sigma_2):\\n    '''Difference of Gaussian by subtracting kernel 1 and kernel 2'''\\n    \\n    k_width = k_height = k_size\\n    x = y = (k_width - 1) // 2\\n    kernel = np.zeros(k_width * k_height)\\n    \\n    # first gaussian kernal\\n    if sigma_1 \u003e 0:\\n        co_1 = 1 / (2 * sigma_1 * sigma_1)\\n        co_2 = 1 / (2 * np.pi * sigma_1 * sigma_1)\\n        i = 0\\n        for v in range(-y, y + 1):\\n            for u in range(-x, x + 1):\\n                kernel[i] = np.exp(-(u*u + v*v) * co_1) * co_2\\n                i += 1\\n    # unity kernel\\n    else:\\n        kernel[x + y * k_width] = 1.0\\n    \\n    # subtract second gaussian from kernel\\n    if sigma_2 \u003e 0:\\n        co_1 = 1 / (2 * sigma_2 * sigma_2)\\n        co_2 = 1 / (2 * np.pi * sigma_2 * sigma_2)\\n        i = 0\\n        for v in range(-y, y + 1):\\n            for u in range(-x, x + 1):\\n                kernel[i] -= np.exp(-(u*u + v*v) * co_1) * co_2\\n                i += 1\\n    # unity kernel\\n    else:\\n        kernel[x + y * k_width] -= 1.0\\n    \\n    # zero-normalize scling kernel with scaling factor 1.0\\n    norm_kernel = normalize_kernel(kernel, k_width, k_height, scaling_factor = 1.0)\\n    \\n    # apply filter with norm_kernel\\n    return cv2.filter2D(img, -1, norm_kernel.reshape(k_width, k_height))\\n\"\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Get Difference of Gaussian (DoG) for image by calling \", _jsx(_components.em, {\n        children: \"dog()\"\n      }), \" function with \", _jsx(_components.strong, {\n        children: \"radius = 15, sigma_1 = 100, sigma_2 = 0\"\n      }), \". Here \", _jsx(_components.strong, {\n        children: \"radius = 15\"\n      }), \" for both kernels, for first kernel, \", _jsx(_components.strong, {\n        children: \"sigma = 100\"\n      }), \", and for second kernel, \", _jsx(_components.strong, {\n        children: \"sigma = 0\"\n      }), \". Kernel with \", _jsx(_components.strong, {\n        children: \"sigma = 0\"\n      }), \" creates unity kernel means convolution with this kernel gives same image.\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-python\",\n        children: \"dog_img = dog(img, 15, 100, 0)\\n\"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"After applying DoG, the resultant image looks like\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: _jsx(_components.img, {\n        src: \"whiteboard-enhance/difference-of-gaussian.jpg\",\n        alt: \"Difference of Gaussian (DoG) Image:=:70:=:Difference of Gaussian (DoG) image\"\n      })\n    }), \"\\n\", _jsx(_components.hr, {}), \"\\n\", _jsx(_components.h3, {\n      children: \"Negative Image\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"For \", _jsx(_components.span, {\n        className: \"math math-inline\",\n        children: _jsxs(_components.span, {\n          className: \"katex\",\n          children: [_jsx(_components.span, {\n            className: \"katex-mathml\",\n            children: _jsx(_components.math, {\n              xmlns: \"http://www.w3.org/1998/Math/MathML\",\n              children: _jsxs(_components.semantics, {\n                children: [_jsx(_components.mrow, {\n                  children: _jsxs(_components.msub, {\n                    children: [_jsx(_components.mi, {\n                      children: \"I\"\n                    }), _jsxs(_components.mrow, {\n                      children: [_jsx(_components.mi, {\n                        children: \"d\"\n                      }), _jsx(_components.mi, {\n                        children: \"o\"\n                      }), _jsx(_components.mi, {\n                        children: \"g\"\n                      })]\n                    })]\n                  })\n                }), _jsx(_components.annotation, {\n                  encoding: \"application/x-tex\",\n                  children: \"I_{dog}\"\n                })]\n              })\n            })\n          }), _jsx(_components.span, {\n            className: \"katex-html\",\n            \"aria-hidden\": \"true\",\n            children: _jsxs(_components.span, {\n              className: \"base\",\n              children: [_jsx(_components.span, {\n                className: \"strut\",\n                style: {\n                  height: \"0.9694em\",\n                  verticalAlign: \"-0.2861em\"\n                }\n              }), _jsxs(_components.span, {\n                className: \"mord\",\n                children: [_jsx(_components.span, {\n                  className: \"mord mathnormal\",\n                  style: {\n                    marginRight: \"0.07847em\"\n                  },\n                  children: \"I\"\n                }), _jsx(_components.span, {\n                  className: \"msupsub\",\n                  children: _jsxs(_components.span, {\n                    className: \"vlist-t vlist-t2\",\n                    children: [_jsxs(_components.span, {\n                      className: \"vlist-r\",\n                      children: [_jsx(_components.span, {\n                        className: \"vlist\",\n                        style: {\n                          height: \"0.3361em\"\n                        },\n                        children: _jsxs(_components.span, {\n                          style: {\n                            top: \"-2.55em\",\n                            marginLeft: \"-0.0785em\",\n                            marginRight: \"0.05em\"\n                          },\n                          children: [_jsx(_components.span, {\n                            className: \"pstrut\",\n                            style: {\n                              height: \"2.7em\"\n                            }\n                          }), _jsx(_components.span, {\n                            className: \"sizing reset-size6 size3 mtight\",\n                            children: _jsxs(_components.span, {\n                              className: \"mord mtight\",\n                              children: [_jsx(_components.span, {\n                                className: \"mord mathnormal mtight\",\n                                children: \"d\"\n                              }), _jsx(_components.span, {\n                                className: \"mord mathnormal mtight\",\n                                children: \"o\"\n                              }), _jsx(_components.span, {\n                                className: \"mord mathnormal mtight\",\n                                style: {\n                                  marginRight: \"0.03588em\"\n                                },\n                                children: \"g\"\n                              })]\n                            })\n                          })]\n                        })\n                      }), _jsx(_components.span, {\n                        className: \"vlist-s\",\n                        children: \"​\"\n                      })]\n                    }), _jsx(_components.span, {\n                      className: \"vlist-r\",\n                      children: _jsx(_components.span, {\n                        className: \"vlist\",\n                        style: {\n                          height: \"0.2861em\"\n                        },\n                        children: _jsx(_components.span, {})\n                      })\n                    })]\n                  })\n                })]\n              })]\n            })\n          })]\n        })\n      }), \", get a negative image which is just an inversion of colors (255 - image).\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-python\",\n        children: \"def negate(img):\\n    '''Negative of image'''\\n    \\n    return cv2.bitwise_not(img)\\n\"\n      })\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-python\",\n        children: \"negative_img = negate(dog_img)\\n\"\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"The result of the inversion image is\\n\", _jsx(_components.img, {\n        src: \"whiteboard-enhance/negative.jpg\",\n        alt: \"Negative image:=:70:=:Negative image\"\n      })]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Image content is not much visible as we inverted an image whose most of the pixels are black. So, to improve the contrast, we apply contrast-stretch enhancement for the negative image.\"\n    }), \"\\n\", _jsx(_components.hr, {}), \"\\n\", _jsx(_components.h3, {\n      children: \"Contrast Stretching\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Contrast stretching of an image is the same as histogram equalization but we cap some percentage of pixel values to black (0) and white (255).\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-python\",\n        children: \"def get_black_white_indices(hist, tot_count, black_count, white_count):\\n    '''Blacking and Whiting out indices same as color balance'''\\n\\n    black_ind = 0\\n    white_ind = 255\\n    co = 0\\n    for i in range(len(hist)):\\n        co += hist[i]\\n        if co \u003e black_count:\\n            black_ind = i\\n            break\\n            \\n    co = 0\\n    for i in range(len(hist) - 1, -1, -1):\\n        co += hist[i]\\n        if co \u003e (tot_count - white_count):\\n            white_ind = i\\n            break\\n    \\n    return [black_ind, white_ind]\\n\\ndef contrast_stretch(img, black_point, white_point):\\n    '''Contrast stretch image with black and white cap'''\\n    \\n    tot_count = img.shape[0] * img.shape[1]\\n    black_count = tot_count * black_point / 100\\n    white_count= tot_count * white_point / 100\\n    ch_hists = []\\n    # calculate histogram for each channel\\n    for ch in cv2.split(img):\\n        ch_hists.append(cv2.calcHist([ch], [0], None, [256], (0, 256)).flatten().tolist())\\n    \\n    # get black and white percentage indices\\n    black_white_indices = []\\n    for hist in ch_hists:\\n        black_white_indices.append(get_black_white_indices(hist, tot_count, black_count, white_count))\\n        \\n    stretch_map = np.zeros((3, 256), dtype = 'uint8')\\n    \\n    # stretch histogram \\n    for curr_ch in range(len(black_white_indices)):\\n        black_ind, white_ind = black_white_indices[curr_ch]\\n        for i in range(stretch_map.shape[1]):\\n            if i \u003c black_ind:\\n                stretch_map[curr_ch][i] = 0\\n            else:\\n                if i \u003e white_ind:\\n                    stretch_map[curr_ch][i] = 255\\n                else:\\n                    if (white_ind - black_ind) \u003e 0:\\n                        stretch_map[curr_ch][i] = round((i - black_ind) / (white_ind - black_ind)) * 255\\n                    else:\\n                        stretch_map[curr_ch][i] = 0\\n    \\n    # stretch image\\n    ch_stretch = []\\n    for i, ch in enumerate(cv2.split(img)):\\n        ch_stretch.append(cv2.LUT(ch, stretch_map[i]))\\n        \\n    return cv2.merge(ch_stretch)\\n\"\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"For each image channel, calculate cummulative histogram sum, and then cap pixels based on \", _jsx(_components.strong, {\n        children: \"black_point = 2\"\n      }), \" and \", _jsx(_components.strong, {\n        children: \"white_point = 99.5\"\n      }), \" percentage.\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-python\",\n        children: \"contrast_stretch_img = contrast_stretch(negative_img, 2, 99.5)\\n\"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Negative image after contrast stretching is\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: _jsx(_components.img, {\n        src: \"whiteboard-enhance/contrast-stretch.jpg\",\n        alt: \"Contrast stretch image:=:70:=:Contrast strech image\"\n      })\n    }), \"\\n\", _jsx(_components.hr, {}), \"\\n\", _jsx(_components.h3, {\n      children: \"Gaussin Blur \u0026 Gamma Correction\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Contrast stretching image contains noise, so blur the image with Gaussian kernel. As Gaussian distribution kernel can be linearly separable, we apply convolution with the same 1D-kernel along the x-axis and y-axis for performance (negligible for small kernels and low-res images).\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-python\",\n        children: \"def fast_gaussian_blur(img, ksize, sigma):\\n    '''Gussian blur using linear separable property of Gaussian distribution'''\\n    \\n    kernel_1d = cv2.getGaussianKernel(ksize, sigma)\\n    return cv2.sepFilter2D(img, -1, kernel_1d, kernel_1d)\\n\\ndef gamma(img, gamma_value):\\n    '''Gamma correction of image'''\\n    \\n    i_gamma = 1 / gamma_value\\n    lut = np.array([((i / 255) ** i_gamma) * 255 for i in np.arange(0, 256)], dtype = 'uint8')\\n    return cv2.LUT(img, lut)\\n\"\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Apply Gaussian blur with \", _jsx(_components.strong, {\n        children: \"kernel_size = 3\"\n      }), \" and \", _jsx(_components.strong, {\n        children: \"sigma = 1\"\n      }), \".\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-python\",\n        children: \"blur_img = fast_gaussian_blur(contrast_stretch_img, 3, 1)\\n\"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Blurred image after noise suppression is\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: _jsx(_components.img, {\n        src: \"whiteboard-enhance/gaussian-blur.jpg\",\n        alt: \"Gaussian blur image:=:70:=:Blurred image\"\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Now apply Gamma correction to enhance the blurred image with \", _jsx(_components.strong, {\n        children: \"gamma_value = 1.1\"\n      }), \".\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-python\",\n        children: \"gamma_img = gamma(blur_img, 1.1)\\n\"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Blurred image Gamma corrected looks like\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: _jsx(_components.img, {\n        src: \"whiteboard-enhance/gamma-correction.jpg\",\n        alt: \"Gamma correction:=:70:=:Gamma corrected image\"\n      })\n    }), \"\\n\", _jsx(_components.hr, {}), \"\\n\", _jsx(_components.h3, {\n      children: \"Color Balance\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Color balance of an image is same as contrast-stretching method above but they are different in implementation. Above contrast-stretching is an implementation based on \", _jsx(_components.a, {\n        href: \"https://imagemagick.org/api/MagickCore/enhance_8c.html\",\n        children: \"ImageMagick-ContrastStretchImage()\"\n      }), \", and \", _jsx(_components.a, {\n        href: \"https://gist.github.com/DavidYKay/9dad6c4ab0d8d7dbf3dc\",\n        children: \"color balance\"\n      }), \" is based on \", _jsx(_components.a, {\n        href: \"https://www.ipol.im/pub/art/2011/llmps-scb/article.pdf\",\n        children: \"Simplest Color Balance\"\n      }), \".\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-python\",\n        children: \"def color_balance(img, low_per, high_per):\\n    '''Contrast stretch image by histogram equilization with black and white cap'''\\n    \\n    tot_pix = img.shape[1] * img.shape[0]\\n    # no.of pixels to black-out and white-out\\n    low_count = tot_pix * low_per / 100\\n    high_count = tot_pix * (100 - high_per) / 100\\n    \\n    cs_img = []\\n    # for each channel, apply contrast-stretch\\n    for ch in cv2.split(img):\\n        # cummulative histogram sum of channel\\n        cum_hist_sum = np.cumsum(cv2.calcHist([ch], [0], None, [256], (0, 256)))\\n\\n        # find indices for blacking and whiting out pixels\\n        li, hi = np.searchsorted(cum_hist_sum, (low_count, high_count))\\n        if (li == hi):\\n            cs_img.append(ch)\\n            continue\\n        # lut with min-max normalization for [0-255] bins\\n        lut = np.array([0 if i \u003c li \\n                        else (255 if i \u003e hi else round((i - li) / (hi - li) * 255)) \\n                        for i in np.arange(0, 256)], dtype = 'uint8')\\n        # constrast-stretch channel\\n        cs_ch = cv2.LUT(ch, lut)\\n        cs_img.append(cs_ch)\\n        \\n    return cv2.merge(cs_img)\\n\"\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Enhance image by passing Gamma corrected image to \", _jsx(_components.strong, {\n        children: \"color_balance()\"\n      }), \" with parameters \", _jsx(_components.strong, {\n        children: \"low_per = 2\"\n      }), \" and \", _jsx(_components.strong, {\n        children: \"high_per = 1\"\n      }), \".\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-python\",\n        children: \"color_balanced_img = color_balance(gamma_img, 2, 1)\\n\"\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"The final enhanced whiteboard image is\\n\", _jsx(_components.img, {\n        src: \"whiteboard-enhance/whiteboard-image-enhanced.jpg\",\n        alt: \"Whiteboard image enhance:=:70:=:Whiteboard image enhanced\"\n      })]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"You can find out full code at my Github repository file \", _jsx(_components.a, {\n        href: \"https://github.com/santhalakshminarayana/whiteboard-image-enhance/blob/main/whiteboard_image_enhance.py\",\n        children: \"whiteboard_image_enhance.py\"\n      })]\n    }), \"\\n\", _jsx(_components.hr, {}), \"\\n\", _jsx(_components.h2, {\n      children: \"Results\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: _jsx(_components.img, {\n        src: \"whiteboard-enhance/img_2.jpg\",\n        alt: \"img_2:=:100\"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: _jsx(_components.img, {\n        src: \"whiteboard-enhance/img_3.jpg\",\n        alt: \"img_3:=:100\"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: _jsx(_components.img, {\n        src: \"whiteboard-enhance/img_4.jpg\",\n        alt: \"img_4:=:100\"\n      })\n    })]\n  });\n}\nfunction MDXContent(props = {}) {\n  const {wrapper: MDXLayout} = Object.assign({}, _provideComponents(), props.components);\n  return MDXLayout ? _jsx(MDXLayout, Object.assign({}, props, {\n    children: _jsx(_createMdxContent, props)\n  })) : _createMdxContent(props);\n}\nreturn {\n  default: MDXContent\n};\n","frontmatter":{},"scope":{}},"id":"whiteboard-image-enhancement-opencv-python"},"__N_SSG":true},"page":"/blog/[id]","query":{"id":"whiteboard-image-enhancement-opencv-python"},"buildId":"oNnEvNfdL8Qy1aUOO18Eo","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>